# Шаблон проектирования MVVM

Одной из типовых проблем при разработке Desktop-приложений (а также мобильных приложений) является высокая сцепленность кода. На практике высокая сцепленность приводит к засорению пространства идентификаторов органов управления в пользовательском интерфейсе, высокой сложности сопровождения кода, усложнению повторного использования кода. Проявлением «сильной сцепленности» является ситуация, когда изменение в одном компоненте вынуждает вносить изменения и в другом компоненте. Худший случай – необходимость выполнять такие изменения по цепочке компонентов, что приводит к существенным временным потерям и ухудшению качества ПО.

Шаблон проектирования предназначен для устранения подобных проблем. Шаблон предполагает разделение ответственности (Separation of Concerns) между тремя основными сторонами:

1. Модель (Model) – это описание используемых сущностей (Entities) как объектов с определённым набором полей. Model не содержит никакой бизнес-логики – это просто контейнеры связанным между собой полей. Примером модели может быть объект, описывающий принятую пачку наличных
2. Отображение (View) – класс, отображающий данные в определённом виде, например, таблицу принятых номиналов, или список подключенных счётчиков
3. Связующий слой (ViewModel) – набор классов, которые отвечают за выполнение некоторых бизнес-операций, включая доступ к базе данных и взаимодействие с аппаратными узлами

Связующий слой (ViewModel) так же можно разделить на несколько слоёв:

1. Контекст данных, к которому могут обращаться различные View и другие классы из ViewModel
2. Обработчики команд, которые оператор может подать через View
3. Helper-ы, классы обеспечивающие выполнение запросов к базе данных, а также доступа к различным устройствам

Предположим, что мы разрабатываем приложение-аггрегатор, которое умеет взаимодействовать с разными платёжными шлюзами, выполняя перевод денежных средств конкретному получателю. «Слабая сцепленность» обеспечивается тем, что при добавлении нового платёжного шлюза с уникальным API добавляется новый Helper-класс и обработчик команды, но сама команда (выполнение платежа) остаётся неизменной. View и Model также не изменяются. Т.е. изменения затрагивают только относительно небольшую часть программного кода и их стоимость будет минимальной.

## Этапность выполнения работ при использовании MVVM

Рекомендуется сначала определить сущности, входящие в модель. Такими сущностями могут быть: описание валюты (идентификатор, цифровой код валюты, буквенный код валюты), количество купюр определённого номинала, принятых в рамках определённой транзакции, транзакция внесения наличных (идентификатор транзакции, к которому привязывается информация о количестве внесённых купюр, дата начала операции, результат выполнения операции, и т.д.).

Следующий шаг – заглушки для View и ViewModel. Под заглушками подразумевается минимально необходимый код, который позволяет убедиться, что коммуникационные каналы между частями приложения настроены корректно и работают. Пример:

* Разработать поле для ввода строки фильтрации данных
*	Разработать часть ViewModel в которую будет сохранено введённое значение
*	Убедиться под отладчиком, что введённое значение сохраняется в переменную
*	Разработать класс, выполняющий команду (Search) во ViewModel
*	Связать View с классом для кнопки «Search» во ViewModel
*	Добавить во ViewModel **ObservableCollection** для конкретной Model, в который будет помещён результат выполнения команды «Search»
*	Добавить во View код, который отображает список из ObservableCollection
*	Убедиться, что вся цепочка работает корректно

Далее следует доработать View с целью добиться желаемого отображения данных.

На последнем этапе – добавляются Helper-ы, которые выполняют запросы к сетевым ресурсам, устройствам и к базе данных.

